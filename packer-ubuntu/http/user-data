#cloud-config
autoinstall:
  version: 1
  identity:
    hostname: ubuntu-template
    password: "$6$B3Zm3jsEKcw3F8oV$8NkqEvLTSTtEGhIq0/e5bG1zWU5XYYnR44aM.l69sMgpedULT3ZyND2EqNvhv2Y2nob9x9w7KZNxkXD/JbfE41"
    username: ubuntu
  storage:
    layout:
      name: lvm
  ssh:
    install-server: true
    allow-pw: true
    authorized-keys:
      - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICD8rHoSb955SBMNq9ECiqR9ZrsMnZd5ulj+lQ/phebQ helenegandar@MacBook-Pro-de-Helene.local"
      - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIDjxQ3vm635t3xZfNo9GduXEUFAuHj/Jef1qq0MqtlO julliatmathias06@gmail.com"
      - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCvTCCTPLTDYIY4x/jdHUxYh62rjeZgjZTL1clFzvof4SFBer8cOPyw13EPJfyWYvbBY0KygmyP6nBxaGi5WDGDP83tkLsv3SgwkaS1kAkRorFfOt8Iwc/rGDp8SEXtoimJO0LHa01yicACLEHuIfL/TnYv6bdB8CC3dPT0TOITCdy24u7/NTmjpjcKBCNBRHj42enOQEwvt26wnYxzdiwGPzBgF0G9neyfHK/vohOjV0mGPduXZsH5mEjLyVsoqlHMpx0KADaa0wA+mW5ldCoMQ4UJKCXE0IbEWvwGrb5Mmj4QHCR7CmO+ef1hctCes90n7wd6P0Faq3QBkVDk2amLvebEZB7ENT1o+Xa10qje7smzGvDFwkOZdDD0AsiuYYqUu+R2+nZ6rkG2+QlPAbiyFoTXLTOz9V6XBlJCRfSMmhtxofAI8qVPi2GFRkcFRig/GqRi2TPjom9/5ga5A0zbpiXVYFteFD6g4UMAJJS8kv3v3FVVMtgbWJYoCUFMXqE= lemageoire@lemageoire-ThinkPad-P52s"
      - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAII9DnNcTE30coZjm48kNt7XM8e6Tl/38Nnwy+8B4cKvT lmedrano@student.42lausanne.ch"
      - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICVl+C5jY3LPReySsRKAELvweIPFLV66RUDZ3N2Q6j2A admin@proxmox3"
  packages:
    - qemu-guest-agent
    - ufw
    - cloud-init
  late-commands:
    - curtin in-target -- systemctl enable qemu-guest-agent
    - curtin in-target -- systemctl start qemu-guest-agent
    - curtin in-target -- ufw default deny incoming
    - curtin in-target -- ufw default allow outgoing
    - curtin in-target -- ufw allow ssh
    - curtin in-target -- ufw --force enable
    - curtin in-target -- sh -c "echo 'ubuntu ALL=(ALL) NOPASSWD:ALL' > /etc/sudoers.d/90-ubuntu-nopasswd"

write_files:
  - path: /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg
    content: |
      network: {config: disabled}
